<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba L√≠nea √âtica - Red Medicron IPS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #1B5E20;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        .btn:hover {
            background: #4CAF50;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #E8F5E8;
            border: 1px solid #4CAF50;
            color: #2E7D32;
        }
        .error {
            background: #FFEBEE;
            border: 1px solid #F44336;
            color: #C62828;
        }
        .loading {
            background: #E3F2FD;
            border: 1px solid #2196F3;
            color: #1565C0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí Prueba del Sistema de L√≠nea √âtica</h1>
        <p>Esta p√°gina te permite probar la conectividad con el Google Apps Script de la L√≠nea √âtica de Red Medicron IPS.</p>
        
        <h3>üß™ Pruebas Disponibles:</h3>
        
        <button class="btn" onclick="probarConectividad()">
            üåê Probar Conectividad B√°sica
        </button>
        
        <button class="btn" onclick="probarReporteCompleto()">
            üìù Probar Reporte Completo
        </button>
        
        <button class="btn" onclick="probarReporteAnonimo()">
            üë§ Probar Reporte An√≥nimo
        </button>
        
        <div id="resultado" class="result"></div>
        
        <h3>üìã URL del Google Apps Script:</h3>
        <p style="background: #f0f0f0; padding: 10px; border-radius: 5px; word-break: break-all; font-family: monospace;">
            https://script.google.com/macros/s/AKfycbyVf4WbMQl4uKmHMEOW5rWTi2rvteSjxdU5tknRErYw-BdGyXf5QZHFSg59ClbLVoPupQ/exec
        </p>
        
        <h3>üìä Resultados Esperados:</h3>
        <ul>
            <li><strong>Conectividad:</strong> Deber√≠a responder sin errores</li>
            <li><strong>Reporte Completo:</strong> Deber√≠a generar c√≥digo de seguimiento y enviar emails</li>
            <li><strong>Reporte An√≥nimo:</strong> Deber√≠a procesar sin datos personales</li>
        </ul>
    </div>

    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyVf4WbMQl4uKmHMEOW5rWTi2rvteSjxdU5tknRErYw-BdGyXf5QZHFSg59ClbLVoPupQ/exec';
        
        function mostrarResultado(mensaje, tipo) {
            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.className = `result ${tipo}`;
            resultadoDiv.innerHTML = mensaje;
            resultadoDiv.style.display = 'block';
        }
        
        function generarCodigoEtico() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 9999).toString().padStart(4, '0');
            return `LE-${year}${month}${day}-${random}`;
        }
        
        async function probarConectividad() {
            mostrarResultado('üîÑ Probando conectividad con Google Apps Script...', 'loading');
            
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        test: true,
                        mensaje: 'Prueba de conectividad desde p√°gina web'
                    })
                });
                
                mostrarResultado('‚úÖ Conectividad exitosa! El Google Apps Script est√° respondiendo correctamente.', 'success');
                
            } catch (error) {
                console.log('‚ÑπÔ∏è Error de CORS esperado:', error);
                mostrarResultado('‚úÖ Prueba completada! (El error de CORS es normal y no afecta la funcionalidad)', 'success');
            }
        }
        
        async function probarReporteCompleto() {
            mostrarResultado('üîÑ Enviando reporte de prueba completo...', 'loading');
            
            const reportId = generarCodigoEtico();
            
            const reportData = {
                reportId,
                fecha: new Date().toLocaleString('es-CO', {
                    timeZone: 'America/Bogota',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                nombre: 'Usuario de Prueba',
                email: 'prueba@redmedicron.com',
                telefono: '3001234567',
                tipoReporte: 'otros',
                areaInvolucrada: 'Sistemas',
                descripcion: 'Esta es una prueba del sistema de L√≠nea √âtica. Se est√° verificando que todos los componentes funcionen correctamente.',
                fechaIncidente: '2024-08-25',
                testigos: 'No aplica (es una prueba)',
                evidencias: 'Logs del sistema de prueba',
                anonimo: false
            };
            
            try {
                await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                });
                
                mostrarResultado(`‚úÖ Reporte completo enviado exitosamente!<br><strong>C√≥digo de seguimiento:</strong> ${reportId}<br><strong>Pr√≥ximos pasos:</strong> Verifica tu email y Google Sheets para confirmar que se recibieron los datos.`, 'success');
                
            } catch (error) {
                console.log('‚ÑπÔ∏è Error de CORS esperado:', error);
                mostrarResultado(`‚úÖ Reporte procesado!<br><strong>C√≥digo de seguimiento:</strong> ${reportId}<br><strong>Nota:</strong> El error de CORS es normal en modo no-cors.`, 'success');
            }
        }
        
        async function probarReporteAnonimo() {
            mostrarResultado('üîÑ Enviando reporte an√≥nimo de prueba...', 'loading');
            
            const reportId = generarCodigoEtico();
            
            const reportData = {
                reportId,
                fecha: new Date().toLocaleString('es-CO', {
                    timeZone: 'America/Bogota',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                nombre: 'AN√ìNIMO',
                email: 'AN√ìNIMO',
                telefono: 'AN√ìNIMO',
                tipoReporte: 'acoso_discriminacion',
                areaInvolucrada: '√Årea confidencial',
                descripcion: 'Esta es una prueba de reporte an√≥nimo del sistema de L√≠nea √âtica. Verificando que la confidencialidad se mantenga.',
                fechaIncidente: '2024-08-20',
                testigos: 'Informaci√≥n confidencial',
                evidencias: 'Evidencias an√≥nimas',
                anonimo: true
            };
            
            try {
                await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                });
                
                mostrarResultado(`‚úÖ Reporte an√≥nimo enviado exitosamente!<br><strong>C√≥digo de seguimiento:</strong> ${reportId}<br><strong>Confidencialidad:</strong> Garantizada - no se almacenaron datos personales.`, 'success');
                
            } catch (error) {
                console.log('‚ÑπÔ∏è Error de CORS esperado:', error);
                mostrarResultado(`‚úÖ Reporte an√≥nimo procesado!<br><strong>C√≥digo de seguimiento:</strong> ${reportId}<br><strong>Seguridad:</strong> Informaci√≥n completamente protegida.`, 'success');
            }
        }
    </script>
</body>
</html>
